define(function(e,t,n){function r(e,t,n){var r=i("<ul>");for(var s=0;s<e;s++){var o=s===t?n:"";i("<li>",{"class":o,html:s+1}).appendTo(r)}return r}var i=e("$"),s=e("easing"),o=e("widget"),u=e("./const"),a=e("./plugins/effects"),f=e("./plugins/autoplay"),l=e("./plugins/circular"),c=e("./plugins/multiple"),h=o.extend({attrs:{triggers:{value:[],getter:function(e){return i(e)}},panels:{value:[],getter:function(e){return i(e)}},hasTriggers:!0,triggerType:"hover",delay:100,effect:"none",easing:"linear",duration:500,activeIndex:0,step:1,length:{readOnly:!0,getter:function(){return this.panels.length/this.get("step")}},viewSize:[],activeTriggerClass:u.ACTIVE_CLASS},setup:function(){this._parseRole(),this._initElement(),this._initPanels(),this._initTriggers(),this._initPlugins(),this.render()},_parseRole:function(e){e=e||this._getDatasetRole();if(!e)return;var t=this.element,n=this.get("triggers"),r=this.get("panels");n.length===0&&(e.trigger||e.nav)&&(n=e.trigger||e.nav.find("> *")),r.length===0&&(e.panel||e.content)&&(r=e.panel||e.content.find("> *")),this.set("triggers",n),this.set("panels",r)},_getDatasetRole:function(e){var t=this.element,e=e||{},n=!1,r=["trigger","panel","nav","content"];return i.each(r,function(r,s){var o=i("[data-role="+s+"]",t);o.length&&(e[s]=o,n=!0)}),n?e:null},_initElement:function(){this.element.addClass(u.UI_SWITCHABLE)},_initPanels:function(){var e=this.panels=this.get("panels");if(e.length===0)throw new Error("panels.length is ZERO");this.content=e.parent().addClass(u.CONTENT_CLASS),e.addClass(u.PANEL_CLASS)},_initTriggers:function(){var e=this.triggers=this.get("triggers");e.length===0&&this.get("hasTriggers")?(this.nav=r(this.get("length"),this.get("activeIndex"),this.get("activeTriggerClass")).appendTo(this.element),this.triggers=this.nav.children()):this.nav=e.parent(),this.triggers.addClass(u.TRIGGER_CLASS),this.nav.addClass(u.NAV_CLASS),this.triggers.each(function(e,t){i(t).data("value",e)}),this._bindTriggers()},_initPlugins:function(){this._plugins=[],this._plug(a),this._plug(f),this._plug(l),this._plug(c)},_bindTriggers:function(){function e(e){n._onFocusTrigger(e.type,i(this).data("value"))}function t(){clearTimeout(n._switchTimer)}var n=this;this.get("triggerType")==="click"?this.triggers.click(e):this.triggers.hover(e,t)},_onFocusTrigger:function(e,t){var n=this;e==="click"?this.switchTo(t):this._switchTimer=setTimeout(function(){n.switchTo(t)},this.get("delay"))},switchTo:function(e){return this.set("activeIndex",e),this},_onRenderActiveIndex:function(e,t){this._triggerIsValid(e,t)&&this._switchTo(e,t)},_switchTo:function(e,t){this.trigger("switch",e,t),this._switchTrigger(e,t),this._switchPanel(this._getPanelInfo(e,t)),this.trigger("switched",e,t)},_triggerIsValid:function(e,t){return e!==t},_switchTrigger:function(e,t){var n=this.triggers;if(n.length<1)return;n.eq(t).removeClass(this.get("activeTriggerClass")),n.eq(e).addClass(this.get("activeTriggerClass"))},_switchPanel:function(e){e.fromPanels.hide(),e.toPanels.show()},_getPanelInfo:function(e,t){var n=this.panels.get(),r=this.get("step"),s,o;if(t>-1){var u=t*r,a=(t+1)*r;s=n.slice(u,a)}return o=n.slice(e*r,(e+1)*r),{toIndex:e,fromIndex:t,toPanels:i(o),fromPanels:i(s)}},prev:function(){var e=this.get("activeIndex"),t=(e-1+this.get("length"))%this.get("length");this.switchTo(t)},next:function(){var e=this.get("activeIndex"),t=(e+1)%this.get("length");this.switchTo(t)},_plug:function(e){if(!e.isNeeded.call(this))return;var t=e.attrs,n=e.methods;if(t)for(var r in t)t.hasOwnProperty(r)&&!(r in this.attrs)&&this.set(r,t[r]);if(n)for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i]);e.install&&e.install.call(this),this._plugins.push(e)},destroy:function(){i.each(this._plugins,function(e,t){t.destroy&&t.destroy.call(this)}),h.superclass.destroy.call(this)}});n.exports=h});